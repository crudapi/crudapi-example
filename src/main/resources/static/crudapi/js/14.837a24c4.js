(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{3799:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"q-pa-md q-gutter-sm bg-page"},[a("q-breadcrumbs",[a("q-breadcrumbs-el",{attrs:{label:"表管理"}}),a("q-breadcrumbs-el",{attrs:{label:"添加"}})],1),a("q-separator"),a("div",{staticClass:"q-pb-md bg-white"},[a("q-banner",{staticClass:"text-black bg-listcolor",attrs:{"inline-actions":""}},[e._v("\n    基本信息\n   ")]),a("div",{staticClass:"row justify-start items-baseline content-center items-center"},[a("div",{staticClass:"row justify-start items-baseline content-center items-center"},[a("div",{staticClass:"q-px-md"},[a("q-item-label",{staticClass:"required query-cond"},[e._v("对象名称:")])],1),a("div",{staticClass:"q-pt-md"},[a("q-input",{attrs:{outlined:"",placeholder:"如product"},model:{value:e.table.name,callback:function(t){e.$set(e.table,"name",t)},expression:"table.name"}})],1)]),a("div",{staticClass:"row justify-start items-baseline content-center items-center"},[a("div",{staticClass:"q-px-md"},[a("q-item-label",{staticClass:"required query-cond"},[e._v("对象复数:")])],1),a("div",{staticClass:"q-pt-md"},[a("q-input",{attrs:{outlined:"",placeholder:"如products"},model:{value:e.table.pluralName,callback:function(t){e.$set(e.table,"pluralName",t)},expression:"table.pluralName"}})],1)]),a("div",{staticClass:"row justify-start items-baseline content-center items-center"},[a("div",{staticClass:"q-px-md"},[a("q-item-label",{staticClass:"required query-cond"},[e._v("表名称:")])],1),a("div",{staticClass:"q-pt-md"},[a("q-input",{attrs:{outlined:"",placeholder:"如ca_product"},model:{value:e.table.tableName,callback:function(t){e.$set(e.table,"tableName",t)},expression:"table.tableName"}})],1)]),a("div",{staticClass:"row justify-start items-baseline content-center items-center"},[a("div",{staticClass:"q-px-md"},[a("q-item-label",{staticClass:"query-cond"},[e._v("中文名称:")])],1),a("div",{staticClass:"q-pt-md"},[a("q-input",{attrs:{outlined:"",placeholder:"如产品"},model:{value:e.table.caption,callback:function(t){e.$set(e.table,"caption",t)},expression:"table.caption"}})],1)]),a("div",{staticClass:"row justify-start items-baseline content-center items-center"},[a("div",{staticClass:"q-px-md"},[a("q-item-label",{staticClass:"query-cond"},[e._v("引擎:")])],1),a("div",{staticClass:"q-pt-md"},[a("q-select",{attrs:{outlined:"",options:e.engineOptions,"emit-value":"","map-options":""},model:{value:e.table.engine,callback:function(t){e.$set(e.table,"engine",t)},expression:"table.engine"}})],1)])])],1),a("div",{staticClass:"bg-table-list"},[a("q-banner",{staticClass:"text-black bg-listcolor",attrs:{"inline-actions":""},scopedSlots:e._u([{key:"action",fn:function(){return[a("q-toggle",{attrs:{label:"数据库逆向"},on:{input:e.onReverseClick},model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}}),a("p",{directives:[{name:"show",rawName:"v-show",value:e.reverse,expression:"reverse"}],staticClass:"q-px-sm"}),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.reverse,expression:"reverse"}],attrs:{unelevated:"",color:"primary",label:"加载元数据"},on:{click:function(t){return e.onLoadMetadataClickAction()}}}),a("p",{staticClass:"q-px-sm"}),a("q-btn",{attrs:{unelevated:"",color:"purple",label:"联合索引（"+e.indexCount+"）"},on:{click:function(t){return e.onIndexClickAction()}}})]},proxy:!0}])}),a("q-table",{attrs:{data:e.table.columns,columns:e.columns,"visible-columns":e.visibleColumns,pagination:e.tablePagination,"row-key":"id",selection:"multiple",selected:e.selected,loading:e.loading,flat:"",separator:"cell","hide-bottom":""},on:{"update:pagination":function(t){e.tablePagination=t},"update:selected":function(t){e.selected=t}},scopedSlots:e._u([{key:"top",fn:function(t){return[a("p",{directives:[{name:"show",rawName:"v-show",value:!e.reverse,expression:"!reverse"}],staticClass:"q-px-sm"}),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:!e.reverse,expression:"!reverse"}],attrs:{disable:0==e.selected.length,unelevated:"",color:"negative",label:"批量删除"},on:{click:function(t){return e.onDeleteClickAction()}}}),a("p",{directives:[{name:"show",rawName:"v-show",value:!e.reverse,expression:"!reverse"}],staticClass:"q-px-sm"}),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:!e.reverse,expression:"!reverse"}],attrs:{unelevated:"",color:"primary",label:"添加字段"},on:{click:function(t){return e.onNewClickAction()}}}),a("p",{directives:[{name:"show",rawName:"v-show",value:!e.reverse,expression:"!reverse"}],staticClass:"q-px-sm"}),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:!e.reverse,expression:"!reverse"}],attrs:{unelevated:"",color:"positive",label:"批量添加字段"},on:{click:function(t){return e.onBatchNewClickAction()}}}),a("q-space"),a("q-btn",{staticClass:"q-ml-md",attrs:{flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen"},on:{click:t.toggleFullscreen}})]}},{key:"body",fn:function(t){return[a("q-tr",{attrs:{props:t}},[a("q-td",[a("q-checkbox",{model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"props.selected"}})],1),a("q-td",{key:"dataClickAction",attrs:{props:t}},[a("q-btn",{attrs:{unelevated:"",color:"negative",label:"删除",flat:"",dense:""},on:{click:function(a){return e.onDeleteClickAction(t.row.id)}}})],1),a("q-td",{key:"displayOrder",attrs:{props:t}},[a("q-btn",{attrs:{round:"",size:"sm",color:"primary",icon:"vertical_align_top",flat:"",dense:""},on:{click:function(a){return e.onTopClick(t.row)}}}),a("q-btn",{attrs:{round:"",size:"sm",color:"primary",icon:"north",flat:"",dense:""},on:{click:function(a){return e.onUpClick(t.row)}}}),a("q-btn",{attrs:{round:"",size:"sm",color:"primary",icon:"south",flat:"",dense:""},on:{click:function(a){return e.onDownClick(t.row)}}}),a("q-btn",{attrs:{round:"",size:"sm",color:"primary",icon:"vertical_align_bottom",flat:"",dense:""},on:{click:function(a){return e.onBottomClick(t.row)}}})],1),a("q-td",{key:"caption",attrs:{props:t}},[a("q-input",{staticStyle:{width:"80px"},model:{value:t.row.caption,callback:function(a){e.$set(t.row,"caption",a)},expression:"props.row.caption"}})],1),a("q-td",{key:"name",attrs:{props:t}},[a("q-input",{staticStyle:{width:"120px"},model:{value:t.row.name,callback:function(a){e.$set(t.row,"name",a)},expression:"props.row.name"}})],1),a("q-td",{key:"description",attrs:{props:t}},[a("q-input",{staticStyle:{width:"150px"},model:{value:t.row.description,callback:function(a){e.$set(t.row,"description",a)},expression:"props.row.description"}})],1),a("q-td",{key:"unsigned",attrs:{props:t}},[a("q-toggle",{model:{value:t.row.unsigned,callback:function(a){e.$set(t.row,"unsigned",a)},expression:"props.row.unsigned"}})],1),a("q-td",{key:"dataType",attrs:{props:t}},[a("q-select",{attrs:{outlined:"",options:e.dataTypeOptions,"emit-value":"","map-options":""},model:{value:t.row.dataType,callback:function(a){e.$set(t.row,"dataType",a)},expression:"props.row.dataType"}})],1),a("q-td",{key:"indexType",attrs:{props:t}},[a("q-select",{attrs:{outlined:"",options:e.indexTypeOptions,"emit-value":"","map-options":""},model:{value:t.row.indexType,callback:function(a){e.$set(t.row,"indexType",a)},expression:"props.row.indexType"}})],1),a("q-td",{key:"indexStorage",attrs:{props:t}},[a("q-select",{attrs:{outlined:"",options:e.indexStorageOptions,"emit-value":"","map-options":""},model:{value:t.row.indexStorage,callback:function(a){e.$set(t.row,"indexStorage",a)},expression:"props.row.indexStorage"}})],1),a("q-td",{key:"indexName",attrs:{props:t}},[a("q-input",{staticStyle:{width:"150px"},model:{value:t.row.indexName,callback:function(a){e.$set(t.row,"indexName",a)},expression:"props.row.indexName"}})],1),a("q-td",{key:"length",attrs:{props:t}},[a("q-input",{staticStyle:{width:"60px"},attrs:{type:"number"},model:{value:t.row.length,callback:function(a){e.$set(t.row,"length",a)},expression:"props.row.length"}})],1),a("q-td",{key:"precision",attrs:{props:t}},[a("q-input",{staticStyle:{width:"50px"},attrs:{type:"number"},model:{value:t.row.precision,callback:function(a){e.$set(t.row,"precision",a)},expression:"props.row.precision"}})],1),a("q-td",{key:"scale",attrs:{props:t}},[a("q-input",{staticStyle:{width:"40px"},attrs:{type:"number"},model:{value:t.row.scale,callback:function(a){e.$set(t.row,"scale",a)},expression:"props.row.scale"}})],1),a("q-td",{key:"autoIncrement",attrs:{props:t}},[a("q-toggle",{model:{value:t.row.autoIncrement,callback:function(a){e.$set(t.row,"autoIncrement",a)},expression:"props.row.autoIncrement"}})],1),a("q-td",{key:"nullable",attrs:{props:t}},[a("span",[a("q-toggle",{model:{value:t.row.nullable,callback:function(a){e.$set(t.row,"nullable",a)},expression:"props.row.nullable"}})],1)]),a("q-td",{key:"defaultValue",attrs:{props:t}},[a("q-input",{staticStyle:{width:"80px"},model:{value:t.row.defaultValue,callback:function(a){e.$set(t.row,"defaultValue",a)},expression:"props.row.defaultValue"}})],1),a("q-td",{key:"seqId",attrs:{props:t}},[e.isStringType(t.row)?a("q-select",{attrs:{outlined:"",options:e.sequenceStringOptions,"option-value":"id","option-label":"caption","emit-value":"","map-options":""},model:{value:t.row.seqId,callback:function(a){e.$set(t.row,"seqId",a)},expression:"props.row.seqId"}}):e.isNumberType(t.row)?a("q-select",{attrs:{outlined:"",options:e.sequenceLongOptions,"option-value":"id","option-label":"caption","emit-value":"","map-options":""},model:{value:t.row.seqId,callback:function(a){e.$set(t.row,"seqId",a)},expression:"props.row.seqId"}}):e._e()],1),a("q-td",{key:"insertable",attrs:{props:t}},[a("span",[a("q-toggle",{model:{value:t.row.insertable,callback:function(a){e.$set(t.row,"insertable",a)},expression:"props.row.insertable"}})],1)]),a("q-td",{key:"updatable",attrs:{props:t}},[a("span",[a("q-toggle",{model:{value:t.row.updatable,callback:function(a){e.$set(t.row,"updatable",a)},expression:"props.row.updatable"}})],1)]),a("q-td",{key:"queryable",attrs:{props:t}},[a("span",[a("q-toggle",{model:{value:t.row.queryable,callback:function(a){e.$set(t.row,"queryable",a)},expression:"props.row.queryable"}})],1)]),a("q-td",{key:"displayable",attrs:{props:t}},[a("span",[a("q-toggle",{model:{value:t.row.displayable,callback:function(a){e.$set(t.row,"displayable",a)},expression:"props.row.displayable"}})],1)])],1)]}}])}),e.table.columns&&e.table.columns.length>0?a("q-separator"):e._e(),a("div",{staticClass:"q-py-md"},[a("div",{staticClass:"row justify-center"},[a("q-btn",{directives:[{name:"show",rawName:"v-show",value:!e.reverse||!!e.isLoadMetadataValid,expression:"!reverse || !!isLoadMetadataValid"}],attrs:{unelevated:"",color:"primary",label:"保存"},on:{click:e.onSubmitClick}})],1)])],1),a("q-dialog",{attrs:{"full-width":"","full-height":"",persistent:""},model:{value:e.showIndexDialog,callback:function(t){e.showIndexDialog=t},expression:"showIndexDialog"}},[a("q-card",[a("q-card-section",[a("div",{staticClass:"text-h6"},[e._v("联合索引")])]),a("q-separator"),a("q-card-section",{staticClass:"scroll"},[a("CIndexList",{ref:"cIndexListRef",model:{value:e.table,callback:function(t){e.table=t},expression:"table"}})],1),a("q-card-actions",{attrs:{align:"center"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"取消",unelevated:"",color:"negative"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"确定",unelevated:"",color:"primary"},on:{click:e.onConfirmIndexClick}})],1)],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:e.showBatchDialog,callback:function(t){e.showBatchDialog=t},expression:"showBatchDialog"}},[a("q-card",[a("q-card-section",[a("div",{staticClass:"text-h6"},[e._v("批量添加")])]),a("q-separator"),a("q-card-section",[a("q-input",{staticStyle:{width:"500px"},attrs:{filled:"",type:"textarea",label:"逗号或者换行隔开"},model:{value:e.columnNames,callback:function(t){e.columnNames=t},expression:"columnNames"}})],1),a("q-card-actions",{attrs:{align:"center"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"取消",unelevated:"",color:"negative"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"确定",unelevated:"",color:"primary"},on:{click:e.onConfirmBatchClick}})],1)],1)],1)],1)},l=[],i=a("448a"),o=a.n(i),s=a("c973"),r=a.n(s),c=(a("4de4"),a("d3b7"),a("a4d3"),a("e01a"),a("b0c0"),a("159b"),a("7db0"),a("ac1f"),a("1276"),a("498a"),a("5319"),a("99af"),a("fb6a"),a("c740"),a("a9e3"),a("a434"),a("5b81"),a("96cf"),a("8e44")),d=a("ed08"),u=a("11ec"),p={data:function(){return{reverse:!1,indexCount:0,isLoadMetadataValid:!0,selected:[],loading:!1,tablePagination:{rowsPerPage:9999},showIndexDialog:!1,showBatchDialog:!1,columnNames:"",visibleColumns:["dataClickAction","displayOrder","caption","name","unsigned","dataType","indexType","indexStorage","indexName","length","precision","scale","autoIncrement","nullable","defaultValue","seqId","insertable","updatable","queryable","displayable","description"],columns:[{name:"dataClickAction",align:"center",label:"操作",field:"dataClickAction",sortable:!1},{name:"displayOrder",align:"left",label:"顺序",field:"displayOrder",sortable:!1},{name:"caption",align:"left",label:"中文名称",field:"caption",sortable:!1},{name:"name",align:"left",label:"英文字段",field:"name",sortable:!1},{name:"description",align:"left",label:"描述",field:"description",sortable:!1},{name:"unsigned",align:"left",label:"无符号",field:"unsigned",sortable:!1},{name:"dataType",align:"left",label:"数据类型",field:"dataType",sortable:!1},{name:"indexType",align:"left",label:"索引类型",field:"indexType",sortable:!1},{name:"indexStorage",align:"left",label:"索引存储",field:"indexStorage",sortable:!1},{name:"indexName",align:"left",label:"索引名称",field:"indexName",sortable:!1},{name:"length",align:"left",label:"长度",field:"length",sortable:!1},{name:"precision",align:"left",label:"精度",field:"precision",sortable:!1},{name:"scale",align:"left",label:"小数",field:"scale",sortable:!1},{name:"autoIncrement",align:"left",label:"自增长",field:"autoIncrement",sortable:!1},{name:"nullable",align:"left",label:"空",field:"nullable",sortable:!1},{name:"defaultValue",align:"left",label:"默认值",field:"defaultValue",sortable:!1},{name:"seqId",align:"left",label:"序列号",field:"seqId",sortable:!1},{name:"insertable",align:"left",label:"插入",field:"insertable",sortable:!1},{name:"updatable",align:"left",label:"编辑",field:"updatable",sortable:!1},{name:"queryable",align:"left",label:"查询",field:"queryable",sortable:!1},{name:"displayable",align:"left",label:"显示",field:"displayable",sortable:!1}],table:{},engineOptions:[{value:"INNODB",label:"InnoDB"},{value:"MYISAM",label:"MyISAM"}],indexTypeOptions:[{value:"NONE",label:"无"},{value:"PRIMARY",label:"主键"},{value:"UNIQUE",label:"唯一"},{value:"INDEX",label:"普通"},{value:"FULLTEXT",label:"全文"}],indexStorageOptions:[{value:"NONE",label:"无"},{value:"BTREE",label:"B树"},{value:"HASH",label:"哈希"}],dataTypeOptions:[{value:"CHAR",label:"定长字符串CHAR"},{value:"VARCHAR",label:"变长字符串VARCHAR"},{value:"PASSWORD",label:"密码PASSWORD"},{value:"ATTACHMENT",label:"附件ATTACHMENT"},{value:"BOOL",label:"布尔BOOL"},{value:"TINYINT",label:"小整数INT"},{value:"INT",label:"整数INT"},{value:"BIGINT",label:"长整数BIGINT"},{value:"FLOAT",label:"浮点数FLOAT"},{value:"DOUBLE",label:"双精度DOUBLE"},{value:"DECIMAL",label:"精确小数DECIMAL"},{value:"DATE",label:"日期DATE"},{value:"TIME",label:"时间TIME"},{value:"DATETIME",label:"日期时间DATETIME"},{value:"TEXT",label:"文本TEXT"},{value:"LONGTEXT",label:"长文本LONGTEXT"},{value:"BLOB",label:"二进制BLOB"},{value:"LONGBLOB",label:"大二进制LONGBLOB"}],sequenceLongOptions:[],sequenceStringOptions:[]}},created:function(){var e=this;return r()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.init();case 2:console.info("created");case 3:case"end":return t.stop()}}),t)})))()},mounted:function(){console.info("mounted")},activated:function(){console.info("activated")},deactivated:function(){console.info("deactivated")},updated:function(){console.info("updated")},destroyed:function(){console.info("destroyed")},filters:{dateTimeFormat:function(e){return d["a"].dateTimeFormat(e)}},computed:{indexLength:function(){return this.table.indexs?this.table.indexs.length:0}},methods:{init:function(e){var t=this;return r()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$store.commit("config/updateIsAllowBack",t.$route.meta.isAllowBack),e.next=3,t.fetchFromServer();case 3:case"end":return e.stop()}}),e)})))()},getInitColumn:function(){return[{id:1,autoIncrement:!0,caption:"编号",dataType:"BIGINT",description:"主键",displayOrder:0,indexName:"primary_key",indexType:"PRIMARY",insertable:!1,length:20,name:"id",nullable:!1,queryable:!1,displayable:!1,unsigned:!0,updatable:!1,systemable:!1},{id:2,autoIncrement:!1,caption:"名称",dataType:"VARCHAR",description:"名称",displayOrder:1,insertable:!0,length:200,name:"name",nullable:!1,queryable:!0,displayable:!0,unsigned:!1,updatable:!0,systemable:!1},{id:3,autoIncrement:!1,caption:"全文索引",dataType:"TEXT",description:"全文索引",displayOrder:2,indexName:"ft_fulltext_body",indexType:"FULLTEXT",insertable:!1,name:"fullTextBody",nullable:!0,queryable:!1,displayable:!1,unsigned:!1,updatable:!1,systemable:!1},{id:4,autoIncrement:!1,caption:"创建时间",dataType:"DATETIME",description:"创建时间",displayOrder:3,insertable:!1,name:"createdDate",nullable:!1,queryable:!1,displayable:!1,unsigned:!1,updatable:!1,systemable:!1},{id:5,autoIncrement:!1,caption:"修改时间",dataType:"DATETIME",description:"修改时间",displayOrder:4,insertable:!1,name:"lastModifiedDate",nullable:!0,queryable:!1,displayable:!1,unsigned:!1,updatable:!1,systemable:!1}]},fetchFromServer:function(){var e=this;return r()(regeneratorRuntime.mark((function t(){var a,n,l,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$q.loading.show({message:"加载中"}),t.prev=1,t.next=4,c["e"].count();case 4:return a=t.sent,console.info(a),n={},n.caption="新建表"+a,n.description="",n.name="newTable"+a,n.pluralName=n.name+"s",n.tableName="ca_newtable"+a,n.engine="INNODB",e.reverse||(n.columns=e.getInitColumn()),e.table=n,t.next=17,c["d"].list(1,999);case 17:l=t.sent,i=l.filter((function(e){return"LONG"===e.sequenceType})),o=l.filter((function(e){return"STRING"===e.sequenceType})),i.unshift({id:null,caption:"无"}),o.unshift({id:null,caption:"无"}),e.sequenceLongOptions=i,e.sequenceStringOptions=o,e.$q.loading.hide(),t.next=31;break;case 27:t.prev=27,t.t0=t["catch"](1),e.$q.loading.hide(),console.error(t.t0);case 31:case"end":return t.stop()}}),t,null,[[1,27]])})))()},onLoadMetadataClickAction:function(){var e=this;return r()(regeneratorRuntime.mark((function t(){var a,n,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.$q.loading.show(),t.next=4,c["e"].getMetadata(e.table.tableName);case 4:a=t.sent,console.dir(a),e.table.name=e.table.tableName,e.table.pluralName=e.table.tableName,e.table.caption=a.Comment?a.Comment:e.table.tableName,e.table.engine=a.Engine.toUpperCase(),e.table.columns=[],n=e.getIndexColumns(a.indexs),l=(new Date).valueOf(),a.columns.forEach((function(t){e.addRowFromMetadata(l++,t,n.single)})),e.addIndexFromMetadata(n.union),e.isLoadMetadataValid=!0,e.$q.loading.hide(),t.next=23;break;case 19:t.prev=19,t.t0=t["catch"](0),console.error(t.t0),e.$q.loading.hide();case 23:case"end":return t.stop()}}),t,null,[[0,19]])})))()},onNewClickAction:function(){this.addRow()},onBatchNewClickAction:function(){this.showBatchDialog=!0},indexsGroupBy:function(e){var t={};return e.forEach((function(e){t[e.Key_name]?t[e.Key_name].push(e):t[e.Key_name]=[e]})),t},getIndexColumns:function(e){var t={},a={},n=this.indexsGroupBy(e);for(var l in n){var i=n[l];i.length>1?(console.info(l+"is union index"),a[i[0].Key_name]=i):t[i[0].Column_name]=i[0]}return{single:t,union:a}},addIndexFromMetadata:function(e){var t=(new Date).valueOf(),a=[],n=this.table.columns;console.dir(n);var l=function(l){var i=e[l],o=[];i.forEach((function(e){var t=e.Column_name,a=n.find((function(e){return e.name===t})).id;o.push({column:{id:a,name:t}})}));var s=i[0],r=null,c=null;"PRIMARY"===s.Key_name?r="PRIMARY":0===s.Non_unique?(r="UNIQUE",c=s.Index_type):(r="INDEX",c=s.Index_type);var d=s.Index_comment?s.Index_comment:s.Key_name,u={id:t++,isNewRow:!0,caption:d,description:d,indexStorage:c,indexType:r,name:s.Key_name,indexLines:o};a.push(u)};for(var i in e)l(i);this.table.indexs=a,this.table.indexs?this.indexCount=this.table.indexs.length:this.indexCount=0},addRowFromMetadata:function(e,t,a){var n=this.table.columns,l=n.length+1,i=t.Type.toUpperCase(),s=t.Field,r=null,c=null,d=null,u=i.split("(");if(u.length>1){var p=u[1].split(")")[0];p.indexOf(",")>0?(c=p.split(",")[0],d=p.split(",")[1]):r=p}var m=null,b=null,f=null,v=a[s];v&&("PRIMARY"===v.Key_name?m="PRIMARY":"FULLTEXT"===v.Index_type?(m="FULLTEXT",f=v.Key_name):0===v.Non_unique?(m="UNIQUE",f=v.Key_name,b=v.Index_type):(m="INDEX",f=v.Key_name,b=v.Index_type));var g=t.Comment?t.Comment:s,h=u[0].replace("UNSIGNED","").trim();"BIT"===h&&(h="BOOL",r=null);var w={id:e,autoIncrement:"auto_increment"===t.Extra,displayOrder:n.length,insertable:!0,nullable:"YES"===t.Null,queryable:!0,displayable:!1,unsigned:i.indexOf("UNSIGNED")>=0,updatable:!0,dataType:h,indexType:m,indexStorage:b,indexName:f,name:s,caption:g,description:g,length:r,precision:c,scale:d,systemable:!1};this.table.columns=[].concat(o()(n.slice(0,l)),[w],o()(n.slice(l)))},addRow:function(){var e=this.table.columns,t=e.length+1,a={id:(new Date).valueOf(),autoIncrement:!1,displayOrder:e.length,insertable:!0,nullable:!0,queryable:!0,displayable:!1,unsigned:!1,updatable:!0,dataType:"VARCHAR",name:"col"+e.length,caption:"列"+e.length,description:"描述"+e.length,length:200,systemable:!1};this.table.columns=[].concat(o()(e.slice(0,t)),[a],o()(e.slice(t)))},addRow2:function(e,t){var a=this.table.columns,n=a.length+1,l={id:e,autoIncrement:!1,displayOrder:a.length,insertable:!0,nullable:!0,queryable:!0,displayable:!1,unsigned:!1,updatable:!0,dataType:t.dataType,name:"col"+a.length,caption:t.caption,description:t.caption,length:t.length,precision:t.precision,scale:t.scale,systemable:!1};this.table.columns=[].concat(o()(a.slice(0,n)),[l],o()(a.slice(n)))},removeRow:function(e){var t=this.table.columns,a=t.findIndex((function(t){return t.id===e}));a>=0&&(this.table.columns=[].concat(o()(t.slice(0,a)),o()(t.slice(a+1))))},batchRemoveRow:function(e){var t=this;e.forEach((function(e){t.removeRow(e)}))},onIndexClickAction:function(){this.showIndexDialog=!0},onDeleteClickAction:function(e){var t=this;return r()(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=[],t.selected.forEach((function(e){n.push(e.id)})),e?t.removeRow(e):(t.batchRemoveRow(n),t.selected=[]);case 3:case"end":return a.stop()}}),a)})))()},onSubmitClick:function(){var e=this;return r()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:try{e.$q.dialog({title:"提交",message:"确认提交吗？",ok:{unelevated:!0},cancel:{color:"negative",unelevated:!0},persistent:!1}).onOk(r()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.onSubmit();case 2:case"end":return t.stop()}}),t)})))).onCancel((function(){})).onDismiss((function(){console.info("I am triggered on both OK and Cancel")}))}catch(a){e.$q.notify("添加失败")}case 1:case"end":return t.stop()}}),t)})))()},onSubmit:function(){var e=this;return r()(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$q.loading.show({message:"提交中"}),t.prev=1,a=Object(u["a"])(!0,{},e.table),a.indexs&&a.indexs.forEach((function(e){e.indexLines.forEach((function(e){var t=e.column.id,n=a.columns.find((function(e){return e.id===t}));e.column.name=n.name,delete e.column.id})),delete e.id,delete e.isNewRow})),n=0,a.columns.forEach((function(t){var a=Number(t.name);if(!isNaN(a)){var l="字段英文名称"+t.name+"不能为数字";throw e.$q.notify(l),l}t.displayOrder=n++,delete t.id})),a.reverse=e.reverse,t.next=9,c["e"].create(a);case 9:e.$q.loading.hide(),e.$q.notify("添加成功"),e.$root.$emit("updateMenuTree"),e.$router.go(-1),t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](1),e.$q.loading.hide(),console.error(t.t0);case 19:case"end":return t.stop()}}),t,null,[[1,15]])})))()},onReverseClick:function(){var e=this;return r()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.reverse&&(e.isLoadMetadataValid=!1),t.next=3,e.fetchFromServer();case 3:case"end":return t.stop()}}),t)})))()},isStringType:function(e){return"CHAR"===e.dataType||"VARCHAR"===e.dataType},isNumberType:function(e){return"TINYINT"===e.dataType||"SMALLINT"===e.dataType||"MEDIUMINT"===e.dataType||"INT"===e.dataType||"BIGINT"===e.dataType},onTopClick:function(e){var t=this.table.columns,a=t.findIndex((function(t){return t.id===e.id}));0!=a&&t.unshift(t.splice(a,1)[0])},onUpClick:function(e){var t=this.table.columns,a=t.findIndex((function(t){return t.id===e.id}));0!=a&&(t[a]=t.splice(a-1,1,t[a])[0],console.dir(t))},onDownClick:function(e){var t=this.table.columns,a=t.findIndex((function(t){return t.id===e.id}));a!=t.length-1&&(t[a]=t.splice(a+1,1,t[a])[0])},onBottomClick:function(e){var t=this.table.columns,a=t.findIndex((function(t){return t.id===e.id}));a!=t.length-1&&t.push(t.splice(a,1)[0])},onConfirmIndexClick:function(){var e=this.$refs["cIndexListRef"],t=e.getData();console.info(t),this.table.indexs=t.indexs,this.table.indexs?this.indexCount=this.table.indexs.length:this.indexCount=0},onConfirmBatchClick:function(){console.info(this.columnNames);var e=this;if(this.columnNames){var t=this.columnNames.replaceAll("\r\n",",").replaceAll("\n",",").replaceAll("，",",").split(","),a=(new Date).valueOf();t.forEach((function(t){e.addRow2(a++,{length:200,caption:t.trim()})}))}}}},m=p,b=(a("f516"),a("2877")),f=a("ead5"),v=a("079e"),g=a("eb85"),h=a("54e1"),w=a("0170"),y=a("27f9"),x=a("ddd8"),q=a("9564"),k=a("9c40"),C=a("eaac"),T=a("2c91"),I=a("bd08"),N=a("db86"),R=a("8f8e"),O=a("24e8"),A=a("f09f"),E=a("a370"),S=a("4b7e"),_=a("7f67"),$=a("eebe"),D=a.n($),L=Object(b["a"])(m,n,l,!1,null,null,null);t["default"]=L.exports;D()(L,"components",{QBreadcrumbs:f["a"],QBreadcrumbsEl:v["a"],QSeparator:g["a"],QBanner:h["a"],QItemLabel:w["a"],QInput:y["a"],QSelect:x["a"],QToggle:q["a"],QBtn:k["a"],QTable:C["a"],QSpace:T["a"],QTr:I["a"],QTd:N["a"],QCheckbox:R["a"],QDialog:O["a"],QCard:A["a"],QCardSection:E["a"],QCardActions:S["a"]}),D()(L,"directives",{ClosePopup:_["a"]})},eb29:function(e,t,a){},f516:function(e,t,a){"use strict";a("eb29")}}]);